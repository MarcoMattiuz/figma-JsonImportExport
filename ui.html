<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono&display=swap" rel="stylesheet">
<h3 class="title"> <span class="smpl"> A simple </span> <br> JSONTextBridge</h2>
<button id="export">Export to Json</button>
<div class="file-section">
  <label for="fileInput" class="file-button">Import Json file</label>
  <input type="file" id="fileInput" style="display:none;" />
  <div id="fileName" class="filename-display"></div>
  <button id="apply">Apply changes</button>
</div>

<div class="credit">By Marco Mattiuz</div>
<style>
  *,html {
    margin: 0;
    padding: 0;
    font-family: 'JetBrains Mono', monospace;
  }
  .smpl {
    color: #80cfff;
    font-size: 0.6rem;
  }
 
  .credit {
    position: absolute;
    right: 10px;
    bottom: 10px;
    color: #80cfff;
    font-size: 0.6rem;
  }
  .file-section {
    box-sizing: border-box;
    max-width: 240px;
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-top: 10px;
    background-color: #f5f5f5;
    /* border: 1px solid #ccc; */
    border-radius: 4px;
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
    padding: 10px;
  }

  .file-button {
    text-align: center;
    box-sizing: border-box;
    display: block;
    max-width: 240px;
    width: 100%;
    margin: 10px 0;
    font-family: 'JetBrains Mono', monospace;
    padding: 6px 12px;
    font-size: 12px;
    background-color: #ff884d;
    border: 1px solid #ff884d;
    border-radius: 4px;
    box-shadow: 0 3px 0 #ffb380;
    color: white;
    cursor: pointer;
    transition: all 0.1s ease-in-out;
  }

  .file-button:active {
    box-shadow: 0 1px 0 #ffb380;
    transform: translateY(2px);
  }

  .filename-display {
    margin: 4px 0;
    font-size: 12px;
    font-family: 'JetBrains Mono', monospace;
    color: #ffb380;
    font-size: 0.8rem;
    display: inline;
  }
 

  body {
    padding: 10px 10px;
    overflow: hidden;
    display: flex;
    flex-flow: column;
    align-items: center;
    justify-content: center;
  }
  .title {
    text-align: center;
    color: #0077cc;
    font-family: inherit;
  }

  button {
    width: 100%;
    margin: 10px 0;
    font-family: 'JetBrains Mono', monospace;
    padding: 6px 12px;
    font-size: 12px;
    background-color: #4da6ff;
    border: 1px solid #4da6ff;
    border-radius: 4px;
    box-shadow: 0 3px 0 #80cfff;
    color: white;
    cursor: pointer;
    transition: all 0.1s ease-in-out;
  }

  button:active {
    box-shadow: 0 1px 0 #80cfff;
    transform: translateY(2px);
  }

  #apply{
    background-color: #ff884d !important;
    border: 1px solid #ff884d !important;
    box-shadow: 0 3px 0 #ffb380 !important;
  }

</style>
<script>
  document.getElementById('fileInput').addEventListener('change', (event) => {
    const file = event.target.files[0];
    if (!file) return;

    const reader = new FileReader();
    document.getElementById('fileName').textContent = file.name;

    reader.onload = () => {
      // Invia il contenuto del file al plugin code.ts
      parent.postMessage({
        pluginMessage: {
          type: 'file-loaded',
          payload: reader.result
        }
      }, '*');
    };

    reader.readAsText(file); // oppure .readAsArrayBuffer per binari
  });


  onmessage = (event) => {
    const msg = event.data.pluginMessage;
    if (msg.type === 'save-json') {
      const blob = new Blob([msg.data], { type: 'application/json' });
      const url = URL.createObjectURL(blob);

      const a = document.createElement('a');
      a.href = url;
      a.download = 'exported-text.json';
      a.click();

      URL.revokeObjectURL(url);
    }
  };



document.getElementById('export').onclick = () => {
  parent.postMessage({ pluginMessage: { type: 'export-text' } }, '*')
}

document.getElementById('apply').onclick = () => {
  parent.postMessage({ pluginMessage: { type: 'apply-text' } }, '*')
}


</script>
